# 错误和异常
<!-- TOC -->

- [错误和异常](#错误和异常)
    - [简介](#简介)
    - [异常类](#异常类)
    - [捕获异常](#捕获异常)

<!-- /TOC -->

## 简介
- .NET framework改进了处理错误的方式。C#处理错误的机制可以为每种错误提供自定义处理方式，并把识别错误的代码和处理错误的代码分离开来。


---
## 异常类
- 在C#中，当出现某个特殊的异常错误条件时，就会创建(或抛出)一个异常对象。这个对象包含又助于跟踪问题的信息。我们可以创建自己的异常类。.NET提供了许多预定义的异常类，下面是部分类，展示了大致的模式。
```
Exception
    SystemException
        ArgumentException
            ArgumentNullException
            ArgumentOutOfRangeException
        ArithmeticException
            OverflowException
        StackOverflowException
        IOException
            FileLoadException
            FileNotFoundException
    ApplicationException
        TargetInvocationException
    CompositionException
        ChangeRejectedException
```

- 上述的所有类都在System名称空间中，但IOException和CompositionException除外。
- IOException在System.IO中，处理文件数据的读写。
- CompositionException在System.ComponentModel.Composition中，该名称空间处理部件和组件的动态加载。

- 一般情况下，异常没有特定的名称空间，异常类应放在生成异常的类所在的名称空间中。

- 对于.NET类，一般的异常类System.Exception派生自System.Object，通常不在代码中抛出该泛型对象，因为它们无法确定错误情况的本质。

- 在该层次结构中有两个重要的类：
    - SystemException——该类用于通常由.NET运行库抛出的异常。例如，栈已满会抛出StackOverflowException。调用参数不正确可以抛出ArgumentException或子类异常。
        - SystemException异常的子类包括表示致命错误和非致命错误的异常。

    - ApplicationException——在`.NET Framework`最初的设计中，时打算把这个类作为自定义应用程序异常类的基类的。不过CLR抛出的一些异常类也派生自这个类。应用程序抛出的异常则派生自SystemExcpetion。所以现在基本不从这里派生了，都是直接从Exception派生。


---
## 捕获异常
- 为了在C#中处理可能的错误情况，一般要把程序的相关部分分为3中不同的类型：
    - try块包含的代码组成了程序的正常操作部分，但这部分程序可能遇到某些严重的错误。
    - catch块包含的代码处理各种错误情况。
    - finally包含的代码清理资源或其他末尾操作。即使在try和catch中return了，finally也会执行。

- 如果检测到一个错误，代码就抛出一个异常。实例化一个异常对象类，并抛出这个异常：
```
throw new OverflowException();
```

- 只要在try中遇到一条throw语句，就会立即查找这个try对应的catch块。程序查找的catch块应表示同一个类或基类中匹配的异常类实例。

- 